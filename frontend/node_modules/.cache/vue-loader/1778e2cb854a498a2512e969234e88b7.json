{"remainingRequest":"C:\\Users\\gabri\\PycharmProjects\\kapiva_gestao_fastapi_vuejs\\frontend\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\gabri\\PycharmProjects\\kapiva_gestao_fastapi_vuejs\\frontend\\src\\components\\FinanceiroCaixaTable.vue?vue&type=style&index=0&id=4d8404d6&scoped=true&lang=css&","dependencies":[{"path":"C:\\Users\\gabri\\PycharmProjects\\kapiva_gestao_fastapi_vuejs\\frontend\\src\\components\\FinanceiroCaixaTable.vue","mtime":1613509040523},{"path":"C:\\Users\\gabri\\PycharmProjects\\kapiva_gestao_fastapi_vuejs\\frontend\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\gabri\\PycharmProjects\\kapiva_gestao_fastapi_vuejs\\frontend\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\gabri\\PycharmProjects\\kapiva_gestao_fastapi_vuejs\\frontend\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\gabri\\PycharmProjects\\kapiva_gestao_fastapi_vuejs\\frontend\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\gabri\\PycharmProjects\\kapiva_gestao_fastapi_vuejs\\frontend\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKYm9keSB7CiAgcGFkZGluZzogMXJlbTsKfQoKLnJpZ2h0ZWQtaW5wdXQgewogIHRleHQtYWxpZ246IHJpZ2h0Cn0KLmxlZnRlZC1pbnB1dCB7CiAgdGV4dC1hbGlnbjogbGVmdAp9Cg=="},{"version":3,"sources":["FinanceiroCaixaTable.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiXA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA","file":"FinanceiroCaixaTable.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <b-container class=\"financeiro-caixa-table\">\n    {{data_caixa}}\n    <b-row align-h=\"center\">\n      <b-col cols=\"4\">\n        <h4 class=\"text-center\"> Caixa - Loja</h4>\n        <b-table responsive striped hover :items=\"computedItems.lojItems\" :fields=\"fields\">\n          <template v-slot:cell(icons)=\"data\">\n            <div class=\"text-center\">\n              <font-awesome-icon icon=\"trash-alt\" :style=\"{color: 'red'}\" size=\"lg\"\n                                 @click=\"deleteRow(data.index, data.item)\"/>\n            </div>\n          </template>\n\n          <template v-slot:head(icons)=\"data\"> <!-- eslint-disable-line-->\n            <div class=\"text-center\">\n              <button type='button' class=\"btn btn-info\" @click=\"addNewRow\">\n                <font-awesome-icon icon=\"plus-circle\"/>\n              </button>\n            </div>\n          </template>\n\n          <template v-for=\"field in editableFields\" v-slot:[`cell(${field.key})`]=\"{ item }\">\n            <template v-if=\"item.editable && field.key =='item'\">\n              <b-input class=\"lefted-input\" v-model=\"item[field.key]\"/> <!-- eslint-disable-line-->\n            </template>\n            <template v-else-if=\"item.editable && field.key =='valor'\">\n              <b-input class=\"righted-input\" v-model=\"item[field.key]\"/> <!-- eslint-disable-line-->\n            </template>\n            <template v-else>\n              {{item[field.key]}}\n            </template>\n          </template>\n        </b-table>\n      </b-col>\n\n      <b-col cols=\"4\">\n        <h4 class=\"text-center\"> Caixa - Sistema</h4>\n        <b-table responsive striped hover :items=\"sist_items\" :fields=\"fields\"></b-table>\n        <h4 class=\"text-center\"> Caixa - Fechamento</h4>\n        <b-table responsive striped hover :items=\"computedItems.resItems\" :fields=\"fields\"></b-table>\n        <b-form @submit.stop.prevent=\"saveCaixa\">\n          <b-button type=\"submit\" variant=\"primary\">Salvar</b-button>\n        </b-form>\n\n<!--          <b-form @submit.stop.prevent=\"getCartao\">-->\n<!--            <b-button type=\"submit\" variant=\"primary\">getCartao</b-button>-->\n<!--          </b-form>-->\n      </b-col>\n\n    </b-row>\n  </b-container>\n</template>\n\n<script>\nimport axios from 'axios'\nimport numeral from 'numeral'\n\nexport default {\n  name: 'FinanceiroCaixaTable',\n  // props: {data_caixa: {type: String}},\n  props: ['data_caixa', 'dados_caixa'],\n  data: function () {\n    return {\n      fields: [\n        {\n          key: 'item',\n          label: 'Item',\n          editable: true,\n          thStyle: {width: '25rem', textAlign: 'left'},\n          tdClass: 'text-left'\n        },\n        {\n          key: 'valor',\n          label: 'Valor',\n          editable: true,\n          thStyle: {width: '20rem', textAlign: 'center'},\n          tdClass: this.valorTdClass\n        },\n        {\n          key: 'icons',\n          label: '',\n          thStyle: {width: '5rem'}\n        }],\n      loj_items: [],\n      sist_items: [],\n      res_items: [],\n      n_outros: 0,\n      sist_troco: 0,\n      sist_pos: 0,\n      sist_dinheiro: 0,\n      loj_suprimento: 0,\n      loj_val_sangria_list: '',\n      loj_cartao: 0,\n      loj_troco: 0,\n      loj_outras_entradas_list: []\n    }\n  },\n  computed: {\n    editableFields () {\n      return this.fields.filter(field => field.editable)\n    },\n    computedItems () {\n      let lojCartao = {\n        item: 'Cartão',\n        valor: this.$options.filters.numero(this.loj_cartao),\n        ref: 'cartao',\n        editable: true\n      }\n      // this.loj_items.push(lojCartao)\n      let lojSubtotal = {\n        item: 'SUBTOTAL',\n        valor: this.$options.filters.numero(this.calculaTotals.lojSubtotal),\n        ref: 'subtotal'\n      }\n      let lojSuprimento = {\n        item: 'Suprimento',\n        valor: this.$options.filters.numero(0 - this.loj_suprimento),\n        ref: 'suprimento'\n      }\n      let lojTotal = {\n        item: 'TOTAL Loja',\n        valor: this.$options.filters.numero(this.calculaTotals.lojTotal),\n        ref: 'total'\n      }\n      let resCaixa = {\n        item: 'RESULTADO',\n        valor: this.$options.filters.numero(this.calculaTotals.resCaixa),\n        ref: 'res_caixa'\n      }\n      let lojItems = this.loj_items.concat(lojCartao, lojSubtotal, lojSuprimento, lojTotal)\n      let resItems = this.res_items.concat(resCaixa)\n      return {\n        lojItems: lojItems, resItems: resItems\n      }\n    },\n    calculaTotals () {\n      var sangria = this.filterItemsByTerm('sangria')\n      var cartao = this.filterItemsByTerm('cartao')\n      var troco = this.filterItemsByTerm('troco')\n      var outros = this.filterItemsByTerm('outr')\n      var subItens = sangria.concat(cartao, troco, outros)\n      var lojSubtotal = subItens.reduce(function (sum, item) {\n        var itemValor = parseFloat(numeral(item.valor).value())\n        if (!isNaN(itemValor)) {\n          return sum + itemValor\n        } else {\n          return sum\n        }\n      }, 0)\n      var lojTotal = lojSubtotal - this.loj_suprimento\n      var sistTotal = this.sist_dinheiro + this.sist_pos + this.sist_troco\n      let resCaixa = lojTotal - sistTotal\n      let totals = {\n        lojSubtotal: this.$options.filters.numero(lojSubtotal),\n        lojTotal: this.$options.filters.numero(lojTotal),\n        sistTotal: this.$options.filters.numero(sistTotal),\n        resCaixa: this.$options.filters.numero(resCaixa)\n      }\n      return totals\n    }\n  },\n  beforeMount () {\n    this.loadCaixa()\n  },\n  mounted () {\n    this.getCartao()\n\n  },\n  methods: {\n    loadCaixa () {\n\n      this.sist_dinheiro = this.dados_caixa.sist_dinheiro\n      this.sist_pos = this.dados_caixa.sist_pos\n      this.sist_troco = this.dados_caixa.sist_troco\n      this.loj_suprimento = this.dados_caixa.loj_suprimento\n      this.loj_val_sangria_list = this.dados_caixa.loj_val_sangria_list\n      this.loj_cartao = this.dados_caixa.loj_cartao\n      this.loj_troco = this.dados_caixa.loj_troco\n      this.loj_outras_entradas_list = this.dados_caixa.loj_outras_entradas_list\n      this.res_caixa = this.dados_caixa.res_caixa\n      this.toTableItems()\n    },\n    saveCaixa () {\n      const path = 'http://localhost:5000/api/financeiro/caixa/table'\n      const payload = {\n        data_caixa: this.data_caixa,\n        loj_suprimento: this.loj_suprimento,\n        sist_troco: this.sist_troco,\n        sist_pos: this.sist_pos,\n        sist_dinheiro: this.sist_dinheiro,\n        loj_val_sangria: JSON.stringify(this.sangriasToList()),\n        loj_cartao: parseFloat(numeral(this.computedItems.lojItems[this.loj_val_sangria.length + 1].valor).value()),\n        // loj_cartao: parseFloat(numeral(this.filterItemsByTerm('cartao')[0].valor).value()),\n        loj_troco: parseFloat(numeral(this.filterItemsByTerm('troco')[0].valor).value()),\n        loj_outras_entradas: JSON.stringify(this.outrasEntrToList()),\n        res_caixa: parseFloat(numeral(this.calculaTotals.resCaixa).value())\n      }\n      axios.post(path, payload)\n        .then(() => {\n        })\n        .catch((error) => {\n          console.log(error)\n        })\n    },\n    getCartao () {\n      const path = `/api/financeiro/caixacartao/${this.data_caixa}`\n      // const path = 'http://localhost:5000/api/financeiro/caixa/cartao'\n      axios.get(path, {params: {data_caixa: this.data_caixa}})\n        .then((res) => {\n          this.loj_cartao = JSON.parse(res.data.loj_cartao)\n        })\n        .catch((error) => {\n          // eslint-disable-next-line\n            console.error(error)\n        })\n    },\n    toTableItems () {\n      for (let i = 0; i < this.loj_val_sangria_list.length; i++) {\n        let lojSangrias = {\n          item: \"Sangria \"+i,\n          valor: this.$options.filters.numero(this.loj_val_sangria_list[i]),\n          ref: 'sangria',\n          editable: true\n        }\n        this.loj_items.push(lojSangrias)\n      }\n      // let lojCartao = {\n      //   item: 'Cartão',\n      //   valor: this.$options.filters.numero(this.loj_cartao),\n      //   ref: 'cartao',\n      //   editable: true\n      // }\n      // this.loj_items.push(lojCartao)\n      let lojTroco = {\n        item: 'Troco',\n        valor: this.$options.filters.numero(this.loj_troco),\n        ref: 'troco',\n        editable: true\n      }\n      this.loj_items.push(lojTroco)\n      for (let i = 0; i < this.loj_outras_entradas_list.length; i++) {\n        let lojOutrasEntradas = {\n          item: this.loj_outras_entradas_list[i].name,\n          valor: this.$options.filters.numero(this.loj_outras_entradas_list[i].valor),\n          ref: 'outr',\n          editable: true\n        }\n        this.loj_items.push(lojOutrasEntradas)\n      }\n      let sistDinheiro = {\n        item: 'Dinheiro',\n        valor: this.$options.filters.numero(this.sist_dinheiro),\n        ref: 'sist_dinheiro'\n      }\n      this.sist_items.push(sistDinheiro)\n      let sistPos = {\n        item: 'P.O.S.',\n        valor: this.$options.filters.numero(this.sist_pos),\n        ref: 'sist_pos'\n      }\n      this.sist_items.push(sistPos)\n      let sistTroco = {\n        item: 'Troco',\n        valor: this.$options.filters.numero(this.sist_troco),\n        ref: 'sist_troco'\n      }\n      this.sist_items.push(sistTroco)\n      let sistTotal = {\n        item: 'TOTAL Sistema',\n        valor: this.$options.filters.numero(this.calculaTotals.sistTotal),\n        ref: 'sist_total'\n      }\n      this.sist_items.push(sistTotal)\n    },\n    filterItemsByTerm (key) {\n      return this.loj_items.filter(item => {\n        return item.ref.toLowerCase().includes(key)\n      })\n    },\n    outrasEntrToList () {\n      var outrasEntrList = []\n      for (let i = 0; i < this.filterItemsByTerm('outr').length; i++) {\n        let outros = {\n          name: this.filterItemsByTerm('outr')[i].item,\n          valor: parseFloat(numeral(this.filterItemsByTerm('outr')[0].valor).value())\n        }\n        outrasEntrList.push(outros)\n      }\n      return outrasEntrList\n    },\n    sangriasToList () {\n      var sangriasList = []\n      for (let i = 0; i < this.filterItemsByTerm('sangria').length; i++) {\n        let sangrias = {\n          name: this.filterItemsByTerm('sangria')[i].item,\n          valor: parseFloat(numeral(this.filterItemsByTerm('sangria')[0].valor).value())\n        }\n        sangriasList.push(sangrias)\n      }\n      return sangriasList\n    },\n    deleteRow (index, item) {\n      var idx = this.loj_items.indexOf(item)\n      if (idx > -1) {\n        this.loj_items.splice(index, 1)\n      }\n    },\n    addNewRow () {\n      this.loj_items.push({\n        item: 'Outros ' + (this.n_outros + 1),\n        valor: this.$options.filters.numero(0),\n        ref: 'outr',\n        editable: true\n      })\n      this.n_outros++\n    },\n    getDadosStone () {\n      var data = null\n\n      var xhr = new XMLHttpRequest()\n\n      xhr.addEventListener('readystatechange', function () {\n        if (this.readyState === this.DONE) {\n          console.log(this.responseText)\n        }\n      })\n      let affiliationCode = '232084871'\n      let referenceDate = this.data_caixa.replace(/-/g, '')\n      let url = 'https://conciliation.stone.com.br/conciliation-file/v2.2/' + referenceDate + '?affiliationCode=' + affiliationCode\n      xhr.open('GET', url)\n      xhr.setRequestHeader('authorization', 'Bearer 7b5fd261-3537-4a8a-bffc-0f2d5ec34501')\n      xhr.setRequestHeader('x-authorization-raw-data', 'kapivacalcados2020emmovimento')\n      xhr.setRequestHeader('x-authorization-encrypted-data', '084da7241e06fa5612edf44693991cb5b1af63e118cf5fdaa27a1faaa866f04162eee459d7536bcdf00ff80e512aa3ad1d9f408b64d3a06b94791d484de09c95')\n      // xhr.setRequestHeader('accept-encoding', 'gzip')\n      xhr.send(data)\n    },\n    getDadosStoneNode () {\n      var request = require('request')\n      var options = {\n        method: 'GET',\n        url: 'https://conciliation.stone.com.br/conciliation-file/v2.2/20200317?affiliationCode=232084871',\n        headers: {\n          authorization: 'Bearer 7b5fd261-3537-4a8a-bffc-0f2d5ec34501',\n          'x-authorization-raw-data': 'kapivacalcados2020emmovimento',\n          'x-authorization-encrypted-data': '084da7241e06fa5612edf44693991cb5b1af63e118cf5fdaa27a1faaa866f04162eee459d7536bcdf00ff80e512aa3ad1d9f408b64d3a06b94791d484de09c95',\n          'accept-encoding': 'gzip'\n        }\n      }\n      request(options, function (error, response, body) {\n        if (error) throw new Error(error)\n        console.log(body)\n      })\n    },\n    valorTdClass (value, key, item) {\n      var firstChar = value.charAt(0)\n      if (firstChar !== '-' && item.ref === 'res_caixa') {\n        return ['text-success', 'text-right']\n      } else if (firstChar === '-' && item.ref === 'res_caixa') {\n        return ['text-danger', 'text-right']\n      } else {\n        return 'text-right'\n      }\n    }\n  }\n}\n</script>\n\n<style scoped>\n  body {\n    padding: 1rem;\n  }\n\n  .righted-input {\n    text-align: right\n  }\n  .lefted-input {\n    text-align: left\n  }\n</style>\n"]}]}